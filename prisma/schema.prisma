datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                Int               @id @default(autoincrement())
  email             String            @unique
  password          String
  name              String
  role              Role              @default(BUYER)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  supplierProfile   SupplierProfile?
  products          Product[]
  rfqs              Rfq[]
  leadResponses     LeadResponse[]
  reviewsGiven      Review[]          @relation("ReviewsGiven")
  reviewsReceived   Review[]          @relation("ReviewsReceived")
  messagesSent      ConversationMessage[] @relation("MessagesSent")
  messagesReceived  ConversationMessage[] @relation("MessagesReceived")
  notifications     Notification[]
  subscription      Subscription?
}

model SupplierProfile {
  id                 Int                  @id @default(autoincrement())
  companyName        String
  address            String
  gstin              String?
  pan                String?
  contactPerson      String
  contactEmail       String
  contactPhone       String
  businessCategories String[]
  serviceAreas       String[]
  certifications     String[]
  verificationStatus VerificationStatus @default(PENDING)
  user               User                 @relation(fields: [userId], references: [id])
  userId             Int                  @unique
}

model Category {
  id          Int         @id @default(autoincrement())
  name        String
  slug        String      @unique
  parentId    Int?
  parent      Category?   @relation("Subcategories", fields: [parentId], references: [id])
  subcategories Category[]  @relation("Subcategories")
  products    Product[]
  rfqs        Rfq[]
}

model Product {
  id             Int           @id @default(autoincrement())
  title          String
  description    String
  images         String[]
  price          Decimal?
  priceOnRequest Boolean       @default(false)
  moq            Int?
  unit           String?
  leadTime       String?
  location       String
  tags           String[]
  status         ProductStatus @default(DRAFT)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  supplier       User          @relation(fields: [supplierId], references: [id])
  supplierId     Int
  category       Category      @relation(fields: [categoryId], references: [id])
  categoryId     Int
}

model Rfq {
  id           Int            @id @default(autoincrement())
  title        String
  description  String
  quantity     Int
  budget       Decimal?
  location     String
  timeline     String
  status       RfqStatus      @default(OPEN)
  createdAt    DateTime       @default(now())
  buyer        User           @relation(fields: [buyerId], references: [id])
  buyerId      Int
  category     Category       @relation(fields: [categoryId], references: [id])
  categoryId   Int
  leadResponses LeadResponse[]
}

model LeadResponse {
  id          Int      @id @default(autoincrement())
  message     String
  quoteAmount Decimal?
  createdAt   DateTime @default(now())
  rfq         Rfq      @relation(fields: [rfqId], references: [id])
  rfqId       Int
  supplier    User     @relation(fields: [supplierId], references: [id])
  supplierId  Int
}

model ConversationMessage {
  id         Int      @id @default(autoincrement())
  message    String
  createdAt  DateTime @default(now())
  sender     User     @relation("MessagesSent", fields: [senderId], references: [id])
  senderId   Int
  receiver   User     @relation("MessagesReceived", fields: [receiverId], references: [id])
  receiverId Int
}

model Plan {
  id           Int            @id @default(autoincrement())
  name         String
  price        Decimal
  productLimit Int
  leadLimit    Int
  features     String[]
  subscriptions Subscription[]
}

model Subscription {
  id        Int      @id @default(autoincrement())
  startDate DateTime
  endDate   DateTime
  status    SubscriptionStatus
  user      User     @relation(fields: [userId], references: [id])
  userId    Int      @unique
  plan      Plan     @relation(fields: [planId], references: [id])
  planId    Int
}

model Review {
  id         Int      @id @default(autoincrement())
  rating     Int
  comment    String
  createdAt  DateTime @default(now())
  buyer      User     @relation("ReviewsGiven", fields: [buyerId], references: [id])
  buyerId    Int
  supplier   User     @relation("ReviewsReceived", fields: [supplierId], references: [id])
  supplierId Int
  visibility ReviewVisibility @default(VISIBLE)
}

model Notification {
  id      Int      @id @default(autoincrement())
  message String
  read    Boolean  @default(false)
  link    String?
  user    User     @relation(fields: [userId], references: [id])
  userId  Int
}

enum Role {
  BUYER
  SUPPLIER
  ADMIN
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum ProductStatus {
  ACTIVE
  DRAFT
  ARCHIVED
}

enum RfqStatus {
  OPEN
  IN_PROGRESS
  CLOSED
  EXPIRED
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  EXPIRED
}

enum ReviewVisibility {
  VISIBLE
  HIDDEN
}
